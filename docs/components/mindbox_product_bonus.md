# Компонент mindbox:product.bonus

## Описание mindbox:product.bonus

Одностраничный компонент, реализующий получение и отображение бонусов, которые получит покупатель при покупке данного товара. Расчет значения начисляемых бонусов осуществляется на стороне сервиса Mindbox.

## Параметры

| Поле                 | Параметр | Описание                                                                |
|----------------------|----------|-------------------------------------------------------------------------|
| Идентификатор товара | ID       | ID товара или торгового предложения                                     |
| Цена товара          | PRICE    | Цена товара или торгового предложения                                   |
| Дополнительный текст               | LABEL | Пользовательский текст, перед значением начисляемых бонусов |

## Особенности работы

Для корректной работы компонента необходимо в настройках модуля включить обработчик `OnEndBufferContent.`

## Пример вызова

```php
$APPLICATION->IncludeComponent(
    'mindbox:product.bonus',
    '',
    [
        'ID' => $item['ID'],
        'PRICE' => $item['MIN_PRICE']['VALUE'],
        'LABEL' => 'Бонусов'
    ]
);
```

## Результат вызова

![Untitled](product-bonus-result.png)

## Кастомизация отображения

Для того чтобы изменить отображение компонента в публичной части, необходимо скопировать стандартный шаблон компонента, и уже в рамках этого шаблона изменять стили.

При изменении кода в файле `template.php` необходимо оставить неизменными классы с префиксом `mindbox-` , это гарантирует безошибочную работу компонента.

## Интеграция компонента в случае использования торговых предложений

Если товары в вашем каталоге имеют торговые предложения и в публичной части реализован функционал переключения карточек товара с помощью js, то для корректной работы компонента необходимо доработать клиентский код js.

Необходимо в код, который отвечает за переключение торгового предложения, встроить следующий код:

```jsx
let mindboxBonusBlock = document.querySelector('.mindbox-product-bonus');
mindboxBonusBlock.dispatchEvent(new CustomEvent("changeProductBonus", {
	detail: { 
		productId: 789, // id торгового предложения
		price: 1000 // цена торгового предложения
	}
}));
```

Пример интеграции со стандартным компонентом `catalog.section`:

```jsx
let th = $(this.obProduct).closest('.catalog_item_wrapp');
let bonusBlock = th.find('.mindbox-product-bonus')[0];

bonusBlock.dispatchEvent(new CustomEvent("changeProductBonus", {
	detail: { 
		productId: obj['ID'], 
		price: obj['PRICE']['DISCOUNT_VALUE'] 
	}
}));
```
